<section class="space-y-6">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-semibold text-text">{{ 'admin.users.title' | t }}</h1>
  </div>

  <div class="flex items-center gap-3" *ngIf="(loading$ | async)">
    <mat-spinner diameter="28"></mat-spinner>
    <span class="text-sm text-muted">Loading users...</span>
  </div>

  <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3" *ngIf="(users$ | async) as users; else loadingTemplate">
    <article *ngFor="let user of users" class="rounded-soft border border-white/10 bg-surface/95 p-5 shadow-soft hover:border-primary/30 transition-colors">
      <header class="flex items-start justify-between mb-4">
        <div class="flex-1">
          <h2 class="text-lg font-semibold text-text mb-1">{{ user.fullName || user.name || user.username }}</h2>
          <div class="text-xs text-muted space-y-1">
            <p *ngIf="user.email">
              <mat-icon class="align-text-bottom text-xs" style="font-size: 14px; width: 14px; height: 14px;">email</mat-icon>
              {{ user.email }}
            </p>
            <p *ngIf="user.phoneNumber">
              <mat-icon class="align-text-bottom text-xs" style="font-size: 14px; width: 14px; height: 14px;">phone</mat-icon>
              {{ user.phoneNumber }}
            </p>
            <p *ngIf="user.username" class="text-muted">
              <mat-icon class="align-text-bottom text-xs" style="font-size: 14px; width: 14px; height: 14px;">person</mat-icon>
              <span>{{ '@' + user.username }}</span>
            </p>
          </div>
        </div>
        <div class="flex flex-col items-end gap-2">
          <mat-chip [color]="user.isActive ? 'primary' : undefined" selected>
            {{ user.isActive ? 'ACTIVE' : 'INACTIVE' }}
          </mat-chip>
          <div class="text-xs font-mono text-muted">ID: #{{ user.id }}</div>
        </div>
      </header>
      <div class="space-y-2 text-sm">
        <div class="flex items-center justify-between border-t border-white/10 pt-3">
          <span class="font-semibold text-text">Role</span>
          <span class="text-muted">{{ user.role }}</span>
        </div>
        <div class="flex items-start justify-between">
          <span class="font-semibold text-text">Permissions</span>
          <span class="text-muted text-right">
            <span *ngFor="let perm of user.permissions; let last = last">
              {{ perm }}<span *ngIf="!last">, </span>
            </span>
            <span *ngIf="user.permissions.length === 0" class="text-muted">None</span>
          </span>
        </div>
        <div class="flex items-center justify-between">
          <span class="font-semibold text-text">Created</span>
          <span class="text-muted">{{ user.createdAt | date: 'short' }}</span>
        </div>
        <div *ngIf="user.ownerId" class="flex items-center justify-between">
          <span class="font-semibold text-text">Generator Owner ID</span>
          <span class="text-muted">#{{ user.ownerId }}</span>
        </div>
      </div>
    </article>
  </div>

  <ng-template #loadingTemplate>
    <div class="flex items-center justify-center p-8">
      <mat-spinner diameter="32"></mat-spinner>
    </div>
  </ng-template>

  <ng-container *ngIf="(users$ | async) as usersCheck">
    <div *ngIf="usersCheck.length === 0 && !(loading$ | async)" class="rounded-soft border border-white/10 bg-surface/90 px-4 py-6 text-center text-sm text-muted">
      No users found.
    </div>
  </ng-container>
</section>
