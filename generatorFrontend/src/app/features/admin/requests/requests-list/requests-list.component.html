<section class="space-y-6">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <h1 class="text-2xl font-semibold text-text">{{ 'admin.requests.title' | t }}</h1>
    <input
      type="search"
      class="w-full max-w-xs rounded-soft border border-white/10 bg-surface/80 px-3 py-2 text-sm text-text"
      [placeholder]="'admin.requests.search' | t"
      [value]="searchTerm()"
      (input)="searchTerm.set($any($event.target).value)"
    />
  </div>

  <div class="flex items-center gap-3" *ngIf="(loading$ | async)">
    <mat-spinner diameter="28"></mat-spinner>
    <span class="text-sm text-muted">Loading requests...</span>
  </div>

  <div class="grid gap-4" *ngIf="filteredRequests().length > 0; else empty">
    <article *ngFor="let request of filteredRequests()" class="rounded-soft border border-white/10 bg-surface/95 p-4 shadow-soft hover:border-primary/30 transition-colors">
      <div class="flex flex-wrap items-start justify-between gap-3 mb-4">
        <div class="flex-1">
          <h2 class="text-lg font-semibold text-text mb-1">
            {{ request.ownerName || request.generatorName }}
          </h2>
          <div class="text-xs text-muted space-y-1">
            <p *ngIf="request.contactPerson" class="font-medium text-text">
              <span class="text-muted">Contact:</span> {{ request.contactPerson }}
            </p>
            <p *ngIf="request.email">
              <mat-icon class="align-text-bottom text-xs" style="font-size: 14px; width: 14px; height: 14px;">email</mat-icon>
              {{ request.email }}
            </p>
            <p *ngIf="request.phoneNumber">
              <mat-icon class="align-text-bottom text-xs" style="font-size: 14px; width: 14px; height: 14px;">phone</mat-icon>
              {{ request.phoneNumber }}
            </p>
            <p *ngIf="request.address">
              <mat-icon class="align-text-bottom text-xs" style="font-size: 14px; width: 14px; height: 14px;">location_on</mat-icon>
              {{ request.address }}
            </p>
          </div>
        </div>
        <div class="flex flex-col items-end gap-2">
          <mat-chip [color]="request.status === 'PENDING' ? undefined : request.status === 'APPROVED' ? 'primary' : 'warn'" selected>
            {{ ('admin.requests.status.' + request.status.toLowerCase()) | t }}
          </mat-chip>
          <a [routerLink]="['/admin/requests', request.id]" class="text-xs text-primary hover:underline">
            View Details â†’
          </a>
        </div>
      </div>
      
      <div class="mt-4 grid gap-3 text-sm md:grid-cols-2 lg:grid-cols-3">
        <div>
          <span class="font-semibold text-text block mb-1">ID</span>
          <p class="text-muted text-xs font-mono">#{{ request.id }}</p>
        </div>
        <div>
          <span class="font-semibold text-text block mb-1">Created</span>
          <p class="text-muted">{{ request.createdAt | date: 'medium' }}</p>
        </div>
        <div *ngIf="request.reviewedAt">
          <span class="font-semibold text-text block mb-1">Reviewed</span>
          <p class="text-muted">{{ request.reviewedAt | date: 'medium' }}</p>
        </div>
        <div *ngIf="request.reviewedBy">
          <span class="font-semibold text-text block mb-1">Reviewed By</span>
          <p class="text-muted">User #{{ request.reviewedBy }}</p>
        </div>
        <div *ngIf="request.notes" class="md:col-span-2 lg:col-span-3">
          <span class="font-semibold text-text block mb-1">Notes</span>
          <p class="text-muted whitespace-pre-wrap">{{ request.notes }}</p>
        </div>
      </div>
      
      <div class="mt-4 flex gap-3 border-t border-white/10 pt-4">
        <button mat-raised-button color="primary" (click)="approve(request)" [disabled]="request.status !== 'PENDING'">
          <mat-icon>check</mat-icon>
          <span class="ml-1">{{ 'admin.requests.approve' | t }}</span>
        </button>
        <button mat-stroked-button color="warn" (click)="reject(request)" [disabled]="request.status !== 'PENDING'">
          <mat-icon>close</mat-icon>
          <span class="ml-1">{{ 'admin.requests.reject' | t }}</span>
        </button>
      </div>
    </article>
  </div>

  <ng-template #empty>
    <div class="rounded-soft border border-white/10 bg-surface/90 px-4 py-6 text-center text-sm text-muted">
      {{ 'admin.requests.empty' | t }}
    </div>
  </ng-template>
</section>
