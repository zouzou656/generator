<ng-container *ngIf="request$ | async as request; else missing">
  <section class="space-y-6">
    <a routerLink="/admin/requests" class="inline-flex items-center gap-2 text-sm text-primary hover:underline">
      <mat-icon class="text-base">arrow_back</mat-icon>
      Back to requests
    </a>
    
    <header class="space-y-3 pb-4 border-b border-white/10">
      <div class="flex items-start justify-between gap-4">
        <div class="flex-1">
          <h1 class="text-3xl font-semibold text-text mb-2">{{ request.ownerName || request.generatorName }}</h1>
          <div class="flex flex-wrap items-center gap-4 text-sm text-muted">
            <span *ngIf="request.contactPerson" class="flex items-center gap-1">
              <mat-icon class="text-base">person</mat-icon>
              {{ request.contactPerson }}
            </span>
            <span *ngIf="request.email" class="flex items-center gap-1">
              <mat-icon class="text-base">email</mat-icon>
              <a [href]="'mailto:' + request.email" class="text-primary hover:underline">{{ request.email }}</a>
            </span>
            <span *ngIf="request.phoneNumber" class="flex items-center gap-1">
              <mat-icon class="text-base">phone</mat-icon>
              <a [href]="'tel:' + request.phoneNumber" class="text-primary hover:underline">{{ request.phoneNumber }}</a>
            </span>
            <span *ngIf="request.address" class="flex items-center gap-1">
              <mat-icon class="text-base">location_on</mat-icon>
              {{ request.address }}
            </span>
          </div>
        </div>
        <mat-chip [color]="request.status === 'APPROVED' ? 'primary' : request.status === 'REJECTED' ? 'warn' : undefined" selected>
          {{ ('admin.requests.status.' + request.status.toLowerCase()) | t }}
        </mat-chip>
      </div>
    </header>
    
    <div class="card-form">
      <h2 class="text-xl font-semibold text-text mb-4">Request Information</h2>
      <dl class="grid gap-4 text-sm md:grid-cols-2">
        <div>
          <dt class="font-semibold text-text mb-1">Request ID</dt>
          <dd class="text-muted font-mono text-xs">#{{ request.id }}</dd>
        </div>
        <div>
          <dt class="font-semibold text-text mb-1">Status</dt>
          <dd class="text-muted">{{ ('admin.requests.status.' + request.status.toLowerCase()) | t }}</dd>
        </div>
        <div>
          <dt class="font-semibold text-text mb-1">Owner Name</dt>
          <dd class="text-muted">{{ request.ownerName }}</dd>
        </div>
        <div *ngIf="request.contactPerson">
          <dt class="font-semibold text-text mb-1">Contact Person</dt>
          <dd class="text-muted">{{ request.contactPerson }}</dd>
        </div>
        <div *ngIf="request.email">
          <dt class="font-semibold text-text mb-1">Email</dt>
          <dd class="text-muted">
            <a [href]="'mailto:' + request.email" class="text-primary hover:underline">{{ request.email }}</a>
          </dd>
        </div>
        <div *ngIf="request.phoneNumber">
          <dt class="font-semibold text-text mb-1">Phone Number</dt>
          <dd class="text-muted">
            <a [href]="'tel:' + request.phoneNumber" class="text-primary hover:underline">{{ request.phoneNumber }}</a>
          </dd>
        </div>
        <div *ngIf="request.address" class="md:col-span-2">
          <dt class="font-semibold text-text mb-1">Address</dt>
          <dd class="text-muted">{{ request.address }}</dd>
        </div>
        <div>
          <dt class="font-semibold text-text mb-1">Created At</dt>
          <dd class="text-muted">{{ request.createdAt | date: 'medium' }}</dd>
        </div>
        <div *ngIf="request.reviewedAt">
          <dt class="font-semibold text-text mb-1">Reviewed At</dt>
          <dd class="text-muted">{{ request.reviewedAt | date: 'medium' }}</dd>
        </div>
        <div *ngIf="request.reviewedBy">
          <dt class="font-semibold text-text mb-1">Reviewed By</dt>
          <dd class="text-muted">User #{{ request.reviewedBy }}</dd>
        </div>
        <div *ngIf="request.notes" class="md:col-span-2">
          <dt class="font-semibold text-text mb-1">Notes</dt>
          <dd class="text-muted whitespace-pre-wrap">{{ request.notes }}</dd>
        </div>
      </dl>
    </div>
    
    <div class="flex gap-3" *ngIf="request.status === 'PENDING'">
      <button mat-raised-button color="primary" (click)="approve(request)">
        <mat-icon>check</mat-icon>
        <span class="ml-1">Approve Request</span>
      </button>
      <button mat-stroked-button color="warn" (click)="reject(request)">
        <mat-icon>close</mat-icon>
        <span class="ml-1">Reject Request</span>
      </button>
    </div>
  </section>
</ng-container>

<ng-template #missing>
  <div class="rounded-soft border border-white/10 bg-surface/90 px-4 py-6 text-center text-sm text-muted">
    Request not found.
  </div>
</ng-template>
