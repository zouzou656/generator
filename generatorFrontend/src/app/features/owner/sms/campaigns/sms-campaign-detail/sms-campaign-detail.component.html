<ng-container *ngIf="campaign$ | async as campaign; else missing">
  <section class="space-y-6">
    <div class="flex items-center justify-between">
      <a routerLink="/owner/sms/campaigns" class="inline-flex items-center gap-2 text-sm text-primary hover:underline">
        <mat-icon class="text-base">arrow_back</mat-icon>
        Back to Campaigns
      </a>
    </div>

    <!-- Campaign Header -->
    <div class="rounded-soft border border-white/10 bg-surface/95 p-6 shadow-soft">
      <div class="flex items-start justify-between mb-6">
        <div class="flex-1">
          <h1 class="text-3xl font-semibold text-text mb-2">{{ campaign.title }}</h1>
          <div class="flex items-center gap-4 text-sm text-muted">
            <span>
              <mat-icon class="align-middle text-sm">schedule</mat-icon>
              Created {{ campaign.createdAt | date: 'short' }}
            </span>
            <span *ngIf="campaign.relatedPeriodYear && campaign.relatedPeriodMonth">
              <mat-icon class="align-middle text-sm">calendar_today</mat-icon>
              Period: {{ formatPeriod(campaign.relatedPeriodYear, campaign.relatedPeriodMonth) }}
            </span>
          </div>
        </div>
        <mat-chip [color]="getStatusColor(campaign.status)" selected class="text-sm">
          {{ campaign.status }}
        </mat-chip>
      </div>

      <!-- Campaign Message Preview -->
      <div class="rounded-soft border border-primary/30 bg-gradient-to-br from-primary/10 to-accent/10 p-6">
        <div class="text-sm font-semibold text-text mb-3">Campaign Message</div>
        <div class="bg-white/95 dark:bg-surface/95 p-4 rounded-lg shadow-lg">
          <div class="whitespace-pre-wrap text-sm leading-relaxed">{{ campaign.messageBody || 'No message' }}</div>
        </div>
      </div>
    </div>

    <!-- Metrics Cards -->
    <div class="grid gap-4 md:grid-cols-4" *ngIf="messages$ | async as messages">
      <div class="rounded-soft border border-success/30 bg-success/10 p-6 text-center shadow-soft hover:shadow-lg transition-all">
        <div class="text-4xl font-bold text-success mb-2">
          {{ getDeliveredCount(messages) }}
        </div>
        <div class="text-xs font-semibold uppercase tracking-wide text-muted">Delivered</div>
      </div>
      <div class="rounded-soft border border-warning/30 bg-warning/10 p-6 text-center shadow-soft hover:shadow-lg transition-all">
        <div class="text-4xl font-bold text-warning mb-2">
          {{ getPendingCount(messages) }}
        </div>
        <div class="text-xs font-semibold uppercase tracking-wide text-muted">Pending</div>
      </div>
      <div class="rounded-soft border border-danger/30 bg-danger/10 p-6 text-center shadow-soft hover:shadow-lg transition-all">
        <div class="text-4xl font-bold text-danger mb-2">
          {{ getFailedCount(messages) }}
        </div>
        <div class="text-xs font-semibold uppercase tracking-wide text-muted">Failed</div>
      </div>
      <div class="rounded-soft border border-primary/30 bg-primary/10 p-6 text-center shadow-soft hover:shadow-lg transition-all">
        <div class="text-4xl font-bold text-primary mb-2">
          {{ messages.length }}
        </div>
        <div class="text-xs font-semibold uppercase tracking-wide text-muted">Total</div>
      </div>
    </div>

    <!-- Messages Table -->
    <div class="rounded-soft border border-white/10 bg-surface/95 p-6 shadow-soft">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-2xl font-semibold text-text">Message Delivery Status</h2>
          <p class="text-sm text-muted mt-1">Track the delivery status of all SMS messages in this campaign</p>
        </div>
        <button mat-stroked-button (click)="refreshMessages()">
          <mat-icon>refresh</mat-icon>
          <span class="ml-2">Refresh</span>
        </button>
      </div>

      <div class="overflow-x-auto" *ngIf="(messages$ | async) as messages">
        <div *ngIf="messages.length > 0">
          <div class="grid gap-3">
            <div 
              *ngFor="let message of messages" 
              class="rounded-soft border border-white/10 bg-surface/50 p-4 hover:bg-surface/70 hover:border-primary/30 transition-all"
            >
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <mat-icon class="text-sm text-muted">phone</mat-icon>
                    <span class="font-semibold text-text">{{ message.phoneNumber || message.recipient }}</span>
                    <mat-chip [color]="getMessageStatusColor(message.status)" selected class="text-xs ml-2">
                      {{ message.status }}
                    </mat-chip>
                  </div>
                  <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-xs text-muted ml-6">
                    <div>
                      <span class="font-semibold text-text">Sent:</span>
                      {{ message.sentAt ? (message.sentAt | date: 'short') : '-' }}
                    </div>
                    <div>
                      <span class="font-semibold text-text">Delivered:</span>
                      {{ message.deliveredAt ? (message.deliveredAt | date: 'short') : '-' }}
                    </div>
                    <div *ngIf="message.errorMessage" class="col-span-2 md:col-span-1">
                      <span class="font-semibold text-danger">Error:</span>
                      <span class="text-danger">{{ message.errorMessage }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div *ngIf="messages.length === 0" class="rounded-soft border border-white/10 bg-surface/50 px-8 py-12 text-center">
          <mat-icon class="text-6xl text-muted mb-4">message</mat-icon>
          <h3 class="text-lg font-semibold text-text mb-2">No messages yet</h3>
          <p class="text-sm text-muted">Messages will appear here once the campaign is sent</p>
        </div>
      </div>
    </div>
  </section>
</ng-container>

<ng-template #missing>
  <div class="rounded-soft border border-white border-opacity-10 bg-surface bg-opacity-95 px-4 py-6 text-center text-sm text-muted">
    <mat-icon class="text-4xl mb-2">error_outline</mat-icon>
    <p>Campaign not found.</p>
  </div>
</ng-template>
