<section class="mx-auto max-w-5xl px-4 py-16">
  <div class="text-center">
    <h1 class="text-4xl font-semibold text-text">{{ 'portal.checkBill.title' | t }}</h1>
    <p class="mt-3 text-base text-muted">{{ 'portal.checkBill.subtitle' | t }}</p>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()" class="mt-10 grid gap-4 rounded-soft bg-surface/90 p-6 shadow-soft">
    <mat-form-field appearance="outline">
      <mat-label>{{ 'portal.checkBill.fields.phone' | t }}</mat-label>
      <input matInput formControlName="phone" placeholder="+96170123456" required />
      <mat-error *ngIf="form.controls.phone.hasError('required')">{{ 'portal.checkBill.validate.phone' | t }}</mat-error>
      <mat-error *ngIf="form.controls.phone.hasError('pattern')">{{ 'portal.checkBill.validate.phone' | t }}</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>{{ 'portal.checkBill.fields.subscription' | t }}</mat-label>
      <input matInput formControlName="subscriptionNumber" />
    </mat-form-field>

    <button mat-raised-button color="primary" [disabled]="loading" class="self-start">{{ 'portal.checkBill.submit' | t }}</button>
  </form>

  <div class="mt-10" *ngIf="submitted">
    <div *ngIf="errorMessage" class="rounded-soft border border-warning/40 bg-warning/10 px-4 py-3 text-sm text-warning">
      {{ errorMessage | t }}
    </div>

    <mat-tab-group *ngIf="!errorMessage && result" class="mt-6">
      <mat-tab [label]="('portal.checkBill.tabs.pending' | t) + ' (' + pendingBills.length + ')'">
        <div class="mt-4 grid gap-4">
          <article *ngFor="let bill of pendingBills" class="rounded-soft border border-primary/20 bg-surface/95 p-4 shadow-soft">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold text-text">{{ bill.nameOnBill }}</h3>
              <mat-chip color="warn" selected>{{ bill.status }}</mat-chip>
            </div>
            <dl class="mt-3 grid gap-2 text-sm text-muted md:grid-cols-2">
              <div><dt class="font-semibold text-text">Period</dt><dd>{{ bill.period }}</dd></div>
              <div><dt class="font-semibold text-text">{{ 'portal.checkBill.bill.due' | t }}</dt><dd>{{ formatDate(bill.dueDate) }}</dd></div>
              <div><dt class="font-semibold text-text">USD</dt><dd>{{ formatMoney(bill.amountUSD, 'USD') }}</dd></div>
              <div><dt class="font-semibold text-text">LBP</dt><dd>{{ formatMoney(bill.amountLBP, 'LBP') }}</dd></div>
            </dl>
            <button mat-stroked-button color="primary" class="mt-4" [matTooltip]="'app.comingSoon' | t" disabled>{{ 'portal.checkBill.bill.pay' | t }}</button>
          </article>
        </div>
      </mat-tab>
      <mat-tab [label]="('portal.checkBill.tabs.paid' | t) + ' (' + paidBills.length + ')'">
        <div class="mt-4 grid gap-4">
          <article *ngFor="let bill of paidBills" class="rounded-soft border border-success/20 bg-surface/95 p-4 shadow-soft">
            <div class="flex items-center justify-between">
              <h3 class="text-lg font-semibold text-text">{{ bill.nameOnBill }}</h3>
              <mat-chip color="primary" selected>{{ bill.status }}</mat-chip>
            </div>
            <dl class="mt-3 grid gap-2 text-sm text-muted md:grid-cols-2">
              <div><dt class="font-semibold text-text">Period</dt><dd>{{ bill.period }}</dd></div>
              <div><dt class="font-semibold text-text">Paid</dt><dd>{{ formatDate(bill.issuedAt ?? bill.billDate) }}</dd></div>
              <div><dt class="font-semibold text-text">USD</dt><dd>{{ formatMoney(bill.amountUSD ?? bill.totalAmount, 'USD') }}</dd></div>
              <div><dt class="font-semibold text-text">LBP</dt><dd>{{ formatMoney(bill.amountLBP, 'LBP') }}</dd></div>
            </dl>
          </article>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</section>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://generator.example/" },
    { "@type": "ListItem", "position": 2, "name": "Check My Bill", "item": "https://generator.example/check-bill" }
  ]
}
</script>
